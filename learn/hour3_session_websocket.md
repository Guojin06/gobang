# ç¬¬3å°æ—¶å­¦ä¹ ï¼šSessionä¼šè¯ç®¡ç†ä¸WebSocketæ·±åº¦è§£æ

## ğŸ¯ æœ¬å°æ—¶å­¦ä¹ ç›®æ ‡

### æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹
1. **Sessionä¼šè¯ç®¡ç†æœºåˆ¶**
2. **WebSocketå®æ—¶é€šä¿¡åŸç†**
3. **æ™ºèƒ½æŒ‡é’ˆåœ¨é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨**
4. **å®šæ—¶å™¨ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†**
5. **çŠ¶æ€æœºè®¾è®¡æ¨¡å¼**

---

## ğŸ“š session.hpp æ ¸å¿ƒæŠ€æœ¯è§£æ

### 1. Sessionç±»è®¾è®¡ - ä¼šè¯çŠ¶æ€ç®¡ç†

#### ğŸ—ï¸ Sessionç±»ç»“æ„åˆ†æ

```cpp
class session {
private:
    uint64_t _ssid;              // Sessionæ ‡è¯†ç¬¦
    uint64_t _uid;               // ç”¨æˆ·ID  
    ss_statu _statu;             // ç™»å½•çŠ¶æ€ï¼šUNLOGIN/LOGIN
    wsserver_t::timer_ptr _tp;   // å®šæ—¶å™¨æ™ºèƒ½æŒ‡é’ˆ
};
```

#### ğŸ­ çŠ¶æ€æœºè®¾è®¡å›¾è§£

```
ç”¨æˆ·è¿æ¥ç”Ÿå‘½å‘¨æœŸçŠ¶æ€è½¬æ¢ï¼š

åˆå§‹è¿æ¥ â”€â”€â–º UNLOGINçŠ¶æ€ â”€â”€â–º èº«ä»½éªŒè¯ â”€â”€â–º LOGINçŠ¶æ€ â”€â”€â–º è¿›å…¥æ¸¸æˆ
    â”‚           â”‚                         â”‚              â”‚
    â”‚           â–¼                         â–¼              â–¼
    â”‚      ä¸´æ—¶Session                 æŒä¹…Session      æ°¸ä¹…Session
    â”‚      (30ç§’è¶…æ—¶)                  (å¯ç»­æœŸ)        (æ¸¸æˆä¸­ä¸è¿‡æœŸ)
    â”‚           â”‚                         â”‚              â”‚
    â”‚           â–¼                         â–¼              â–¼
    â””â”€â”€â”€ è¶…æ—¶è‡ªåŠ¨æ¸…ç† â—„â”€â”€â”€â”€ é€€å‡ºç™»å½• â—„â”€â”€â”€â”€ é€€å‡ºæ¸¸æˆ â—„â”€â”€â”€â”€â”€â”˜
```

#### ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦Sessionï¼Ÿ

**ç”Ÿæ´»ç±»æ¯”ï¼šé…’åº—æˆ¿å¡ç³»ç»Ÿ**
```
ä¼ ç»ŸHTTP vs WebSocket+Sessionï¼š

HTTPæ–¹å¼ï¼ˆæ— çŠ¶æ€ï¼‰ï¼š         WebSocket+Sessionï¼ˆæœ‰çŠ¶æ€ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¯æ¬¡éƒ½è¦é‡æ–°     â”‚         â”‚ ä¸€æ¬¡éªŒè¯ï¼Œ      â”‚
â”‚ éªŒè¯èº«ä»½        â”‚         â”‚ æŒç»­æœ‰æ•ˆ        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®¢æˆ·ï¼š"æˆ‘æ˜¯å¼ ä¸‰" â”‚         â”‚ æˆ¿å¡ï¼š123456    â”‚
â”‚ æœåŠ¡å‘˜ï¼š"è¯·è¯æ˜" â”‚  vs     â”‚ æœåŠ¡å‘˜ï¼š"å·²è¯†åˆ«" â”‚
â”‚ å®¢æˆ·ï¼šå‡ºç¤ºèº«ä»½è¯  â”‚         â”‚ å®¢æˆ·ï¼šåˆ·å¡å³å¯   â”‚
â”‚ æœåŠ¡å‘˜ï¼š"ç¡®è®¤"   â”‚         â”‚ æœåŠ¡å‘˜ï¼š"é€šè¿‡"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      é‡å¤éªŒè¯å¼€é”€                  é«˜æ•ˆè¯†åˆ«
```

### 2. æ™ºèƒ½æŒ‡é’ˆçš„å®é™…åº”ç”¨

#### ğŸ§  session_ptr çš„è®¾è®¡æ™ºæ…§

```cpp
using session_ptr = std::shared_ptr<session>;  // ç±»å‹åˆ«å
```

**ä¸ºä»€ä¹ˆä½¿ç”¨shared_ptrï¼Ÿ**

```cpp
// å¤šä¸ªåœ°æ–¹å¯èƒ½åŒæ—¶å¼•ç”¨åŒä¸€ä¸ªsessionï¼š
1. session_manager å­˜å‚¨ session_ptr
2. å®šæ—¶å™¨å›è°ƒå‡½æ•° æŒæœ‰ session_ptr  
3. WebSocketè¿æ¥ å…³è” session_ptr
4. åœ¨çº¿ç®¡ç†å™¨ å¯èƒ½å¼•ç”¨ session_ptr

// ä½¿ç”¨shared_ptrçš„å¥½å¤„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  å¼•ç”¨è®¡æ•°=3  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ session_manager â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    sessionå¯¹è±¡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   (å†…å­˜å®‰å…¨)    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  å¼•ç”¨è®¡æ•°=2  â”‚                â”‚
â”‚   timerå›è°ƒ     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚     å‘¨æœŸ        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  å¼•ç”¨è®¡æ•°=1  â”‚                â”‚
â”‚ websocketè¿æ¥   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  æœ€åä¸€ä¸ªå¼•ç”¨   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  é‡Šæ”¾æ—¶è‡ªåŠ¨é”€æ¯  â”‚
                   å¼•ç”¨è®¡æ•°=0   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ”’ çº¿ç¨‹å®‰å…¨çš„Sessionç®¡ç†

```cpp
session_ptr create_session(uint64_t uid, ss_statu statu) {
    std::unique_lock<std::mutex> lock(_mutex);  // RAIIè‡ªåŠ¨åŠ é”
    
    // åˆ›å»ºæ–°session (æ™ºèƒ½æŒ‡é’ˆç®¡ç†)
    session_ptr ssp(new session(_next_ssid));
    ssp->set_statu(statu);
    ssp->set_user(uid);
    
    // çº¿ç¨‹å®‰å…¨åœ°æ’å…¥åˆ°ç®¡ç†å®¹å™¨ä¸­
    _session.insert(std::make_pair(_next_ssid, ssp));
    _next_ssid++;  // åŸå­æ€§åœ°é€’å¢ID
    
    return ssp;  // è¿”å›æ™ºèƒ½æŒ‡é’ˆï¼Œå¼•ç”¨è®¡æ•°+1
}  // lockè‡ªåŠ¨ææ„ï¼Œmutexè‡ªåŠ¨è§£é”
```

### 3. WebSocketæŠ€æœ¯æ·±åº¦è§£æ

#### ğŸŒ WebSocket vs HTTP æœ¬è´¨åŒºåˆ«

```
HTTPé€šä¿¡æ¨¡å¼ï¼š                    WebSocketé€šä¿¡æ¨¡å¼ï¼š
    
å®¢æˆ·ç«¯              æœåŠ¡å™¨          å®¢æˆ·ç«¯              æœåŠ¡å™¨
   â”‚                  â”‚               â”‚                  â”‚
   â”‚ â”€â”€â”€â”€ è¯·æ±‚ â”€â”€â”€â”€â–¶  â”‚               â”‚ â”€â”€â”€â”€ æ¡æ‰‹ â”€â”€â”€â”€â–¶  â”‚
   â”‚                  â”‚               â”‚                  â”‚  
   â”‚ â—„â”€â”€â”€ å“åº” â”€â”€â”€â”€  â”‚               â”‚ â—„â”€â”€â”€ ç¡®è®¤ â”€â”€â”€â”€  â”‚
   â”‚                  â”‚               â”‚                  â”‚
   â”‚ è¿æ¥å…³é—­          â”‚               â”‚ â†â”€â”€â”€â”€ æ¶ˆæ¯ â”€â”€â”€â”€  â”‚
   â”‚                  â”‚               â”‚                  â”‚
   â”‚ â”€â”€â”€â”€ æ–°è¯·æ±‚ â”€â”€â”€â–¶ â”‚               â”‚ â”€â”€â”€â”€ æ¶ˆæ¯ â”€â”€â”€â”€â–¶  â”‚
   â”‚                  â”‚               â”‚                  â”‚
   â”‚ â—„â”€â”€â”€ æ–°å“åº” â”€â”€â”€â”€ â”‚               â”‚ â†â”€â”€â”€â”€ æ¶ˆæ¯ â”€â”€â”€â”€  â”‚
   â”‚                  â”‚               â”‚                  â”‚
   â”‚ å†æ¬¡å…³é—­          â”‚               â”‚ æŒç»­è¿æ¥çŠ¶æ€      â”‚
   
   æ¯æ¬¡é‡æ–°å»ºç«‹è¿æ¥                     ä¸€æ¬¡è¿æ¥ï¼ŒåŒå‘é€šä¿¡
   å®¢æˆ·ç«¯ä¸»åŠ¨è¯·æ±‚                       æœåŠ¡å™¨å¯ä¸»åŠ¨æ¨é€
   æ— çŠ¶æ€åè®®                          æœ‰çŠ¶æ€è¿æ¥
```

#### ğŸ”§ websocketppåº“çš„ä½¿ç”¨

```cpp
#include <websocketpp/server.hpp>
#include <websocketpp/config/asio_no_tls.hpp>

// ç±»å‹å®šä¹‰ï¼š
typedef websocketpp::server<websocketpp::config::asio> wsserver_t;
//          â†‘                      â†‘
//       æœåŠ¡å™¨ç±»å‹              é…ç½®ç±»å‹(å¼‚æ­¥IOï¼Œæ— TLS)
```

**ä¸ºä»€ä¹ˆé€‰æ‹©websocketppï¼Ÿ**
1. **é«˜æ€§èƒ½**ï¼šåŸºäºboost::asioå¼‚æ­¥IO
2. **æ˜“ç”¨æ€§**ï¼šC++æ¥å£å‹å¥½ï¼Œå›è°ƒæœºåˆ¶æ¸…æ™°
3. **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒå®šæ—¶å™¨ã€è¿æ¥ç®¡ç†ç­‰
4. **è·¨å¹³å°**ï¼šLinux/Windowséƒ½æ”¯æŒ

### 4. å®šæ—¶å™¨ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### â° Sessionè¶…æ—¶ç®¡ç†æœºåˆ¶

**å¤æ‚çš„å®šæ—¶å™¨çŠ¶æ€è½¬æ¢ï¼š**

```cpp
void set_session_expire_time(uint64_t ssid, int ms) {
    // å››ç§æƒ…å†µçš„çŠ¶æ€è½¬æ¢ï¼š
    
    // æƒ…å†µ1ï¼šæ°¸ä¹… â†’ æ°¸ä¹… (æ— æ“ä½œ)
    if (tp == nullptr && ms == SESSION_FOREVER) return;
    
    // æƒ…å†µ2ï¼šæ°¸ä¹… â†’ å®šæ—¶åˆ é™¤
    if (tp == nullptr && ms != SESSION_FOREVER) {
        wsserver_t::timer_ptr tmp_tp = _server->set_timer(ms, 
            std::bind(&session_manager::remove_session, this, ssid));
        ssp->set_timer(tmp_tp);
    }
    
    // æƒ…å†µ3ï¼šå®šæ—¶åˆ é™¤ â†’ æ°¸ä¹…
    if (tp != nullptr && ms == SESSION_FOREVER) {
        tp->cancel();  // å–æ¶ˆåŸå®šæ—¶å™¨
        ssp->set_timer(wsserver_t::timer_ptr());  // æ¸…ç©ºå®šæ—¶å™¨
        // å¼‚æ­¥é‡æ–°æ·»åŠ sessionï¼ˆé¿å…ç«æ€æ¡ä»¶ï¼‰
        _server->set_timer(0, std::bind(&session_manager::append_session, this, ssp));
    }
    
    // æƒ…å†µ4ï¼šå®šæ—¶åˆ é™¤ â†’ æ–°çš„å®šæ—¶åˆ é™¤
    if (tp != nullptr && ms != SESSION_FOREVER) {
        tp->cancel();  // å–æ¶ˆåŸå®šæ—¶å™¨
        ssp->set_timer(wsserver_t::timer_ptr());
        _server->set_timer(0, std::bind(&session_manager::append_session, this, ssp));
        // è®¾ç½®æ–°çš„å®šæ—¶å™¨
        wsserver_t::timer_ptr tmp_tp = _server->set_timer(ms, 
            std::bind(&session_manager::remove_session, this, ssp->ssid()));
        ssp->set_timer(tmp_tp);
    }
}
```

#### ğŸ® æ¸¸æˆåœºæ™¯ä¸­çš„Sessionç®¡ç†

```
Sessionç”Ÿå‘½å‘¨æœŸåœ¨ä¸åŒæ¸¸æˆçŠ¶æ€ä¸‹çš„ç®¡ç†ï¼š

è¿æ¥å»ºç«‹ â”€â”€â–º æœªç™»å½•çŠ¶æ€ â”€â”€â–º ç™»å½•çŠ¶æ€ â”€â”€â–º æ¸¸æˆå¤§å… â”€â”€â–º æ¸¸æˆæˆ¿é—´ â”€â”€â–º æ¸¸æˆè¿›è¡Œä¸­
   â”‚           â”‚             â”‚          â”‚          â”‚          â”‚
   â”‚        30ç§’è¶…æ—¶       æ— é™æœŸ      æ— é™æœŸ      æ— é™æœŸ      æ— é™æœŸ
   â”‚           â”‚             â”‚          â”‚          â”‚          â”‚
   â”‚           â–¼             â”‚          â”‚          â”‚          â”‚
   â”‚       è‡ªåŠ¨æ¸…ç†           â”‚          â”‚          â”‚          â”‚
   â”‚                        â”‚          â”‚          â”‚          â”‚
   â””â”€â”€ ç™»å½•å¤±è´¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚          â”‚          â”‚
                                      â”‚          â”‚          â”‚
   é€€å‡ºç™»å½• â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚          â”‚
                                                â”‚          â”‚
   é€€å‡ºå¤§å… â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                                                          â”‚
   é€€å‡ºæˆ¿é—´ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è®¾è®¡åŸåˆ™ï¼š
â€¢ æœªç™»å½•ï¼šçŸ­æœŸä¿ç•™ï¼Œé˜²æ­¢æ¶æ„è¿æ¥å ç”¨èµ„æº
â€¢ å·²ç™»å½•ï¼šé•¿æœŸä¿ç•™ï¼Œä½†å…è®¸è¶…æ—¶æ¸…ç†
â€¢ æ¸¸æˆä¸­ï¼šæ°¸ä¹…ä¿ç•™ï¼Œä¿è¯æ¸¸æˆä¸è¢«æ„å¤–ä¸­æ–­
```

### 5. å…³é”®æŠ€æœ¯è¦ç‚¹è¯¦è§£

#### ğŸ” std::bind å›è°ƒæœºåˆ¶

```cpp
// std::bindçš„ä½œç”¨ï¼šå°†æˆå‘˜å‡½æ•°ç»‘å®šä¸ºå¯è°ƒç”¨å¯¹è±¡
_server->set_timer(ms, std::bind(&session_manager::remove_session, this, ssid));
//                     â†‘                                        â†‘      â†‘
//                  ç»‘å®šå‡½æ•°                                   this  å‚æ•°
```

**std::bindå·¥ä½œåŸç†ï¼š**
```cpp
// åŸå§‹æˆå‘˜å‡½æ•°ç­¾åï¼š
void session_manager::remove_session(uint64_t ssid);

// ä½¿ç”¨std::bindåï¼š
auto callback = std::bind(&session_manager::remove_session, this, ssid);
//   â†‘                                                      â†‘      â†‘
// å¯è°ƒç”¨å¯¹è±¡                                             å¯¹è±¡   å‚æ•°

// ç­‰ä»·äºåˆ›å»ºäº†ä¸€ä¸ªlambdaï¼š
auto callback = [this, ssid]() { 
    this->remove_session(ssid); 
};
```

#### ğŸ—ºï¸ std::unordered_map çš„é€‰æ‹©

```cpp
std::unordered_map<uint64_t, session_ptr> _session;
```

**ä¸ºä»€ä¹ˆé€‰æ‹©unordered_mapï¼Ÿ**

| å®¹å™¨ç±»å‹ | æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦ | æ’å…¥æ—¶é—´å¤æ‚åº¦ | å†…å­˜å¼€é”€ | é€‚ç”¨åœºæ™¯ |
|---------|---------------|---------------|----------|----------|
| `std::map` | O(log n) | O(log n) | è¾ƒå°‘ | éœ€è¦æœ‰åºéå† |
| `std::unordered_map` | O(1)å¹³å‡ | O(1)å¹³å‡ | è¾ƒå¤š | é¢‘ç¹æŸ¥æ‰¾æ“ä½œ |

åœ¨Sessionç®¡ç†ä¸­ï¼š
- **æŸ¥æ‰¾é¢‘ç‡é«˜**ï¼šæ¯æ¬¡WebSocketæ¶ˆæ¯éƒ½è¦æŸ¥æ‰¾session
- **æ’å…¥åˆ é™¤é¢‘ç‡ä¸­ç­‰**ï¼šç”¨æˆ·ç™»å½•/é€€å‡ºæ—¶æ“ä½œ
- **ä¸éœ€è¦æœ‰åºæ€§**ï¼šsession IDæœ¬èº«æ²¡æœ‰é¡ºåºè¦æ±‚

**æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹ï¼š**
```
10000ä¸ªå¹¶å‘ç”¨æˆ·çš„æŸ¥æ‰¾æ€§èƒ½ï¼š
std::map:           logâ‚‚(10000) â‰ˆ 13.3 æ¬¡æ¯”è¾ƒ
std::unordered_map: å¹³å‡ 1 æ¬¡å“ˆå¸ŒæŸ¥æ‰¾

æ€§èƒ½æå‡ï¼š13å€ï¼
```

#### ğŸ”’ çº¿ç¨‹å®‰å…¨è®¾è®¡æ¨¡å¼

é¡¹ç›®ä¸­ä½¿ç”¨çš„çº¿ç¨‹å®‰å…¨æ¨¡å¼ï¼š

```cpp
// æ¨¡å¼1ï¼šRAIIé”ç®¡ç†
session_ptr get_session_by_ssid(uint64_t ssid) {
    std::unique_lock<std::mutex> lock(_mutex);  // æ„é€ æ—¶åŠ é”
    auto it = _session.find(ssid);
    if (it == _session.end()) {
        return session_ptr();  // ç©ºæ™ºèƒ½æŒ‡é’ˆ
    }
    return it->second;
}  // ææ„æ—¶è‡ªåŠ¨è§£é”

// æ¨¡å¼2ï¼šè¿”å›å€¼ä¼˜åŒ– + æ™ºèƒ½æŒ‡é’ˆ
// å³ä½¿åœ¨é”é‡Šæ”¾åï¼Œè¿”å›çš„session_pträ»ç„¶å®‰å…¨
// å› ä¸ºæ™ºèƒ½æŒ‡é’ˆå¢åŠ äº†å¼•ç”¨è®¡æ•°ï¼Œç¡®ä¿å¯¹è±¡ä¸ä¼šè¢«è¯¯åˆ 
```

---

## ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯

### ç½‘ç»œæ¸¸æˆä¸­çš„Sessionåº”ç”¨

```cpp
// åœºæ™¯1ï¼šç”¨æˆ·ç™»å½•
void handle_login(websocket_connection conn, std::string username, std::string password) {
    if (verify_user(username, password)) {
        uint64_t uid = get_user_id(username);
        session_ptr ssp = session_mgr->create_session(uid, LOGIN);
        
        // å»ºç«‹è¿æ¥ä¸sessionçš„å…³è”
        conn->set_session_id(ssp->ssid());
        
        // è®¾ç½®ç™»å½•åçš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯”å¦‚5åˆ†é’Ÿæ— æ“ä½œè‡ªåŠ¨é€€å‡ºï¼‰
        session_mgr->set_session_expire_time(ssp->ssid(), 300000);
        
        send_login_success(conn, ssp->ssid());
    }
}

// åœºæ™¯2ï¼šè¿›å…¥æ¸¸æˆå¤§å…
void handle_enter_hall(websocket_connection conn) {
    uint64_t ssid = conn->get_session_id();
    session_ptr ssp = session_mgr->get_session_by_ssid(ssid);
    
    if (ssp && ssp->is_login()) {
        // è¿›å…¥å¤§å…åï¼Œsessionå˜ä¸ºæ°¸ä¹…ï¼ˆç›´åˆ°ä¸»åŠ¨é€€å‡ºï¼‰
        session_mgr->set_session_expire_time(ssid, SESSION_FOREVER);
        
        // åœ¨çº¿ç®¡ç†å™¨è®°å½•ç”¨æˆ·è¿›å…¥å¤§å…
        online_mgr->enter_game_hall(ssp->get_user(), conn);
    }
}

// åœºæ™¯3ï¼šå¼€å§‹æ¸¸æˆ
void handle_start_game(websocket_connection conn) {
    uint64_t ssid = conn->get_session_id();
    session_ptr ssp = session_mgr->get_session_by_ssid(ssid);
    
    if (ssp && ssp->is_login()) {
        // æ¸¸æˆä¸­sessionå¿…é¡»æ°¸ä¹…ä¿å­˜ï¼Œé˜²æ­¢æ¸¸æˆä¸­é€”æ–­çº¿
        session_mgr->set_session_expire_time(ssid, SESSION_FOREVER);
    }
}
```

### WebSocketæ¶ˆæ¯å¤„ç†æµç¨‹

```cpp
// å®Œæ•´çš„æ¶ˆæ¯å¤„ç†é“¾è·¯ï¼š
void on_message(websocket_connection conn, std::string message) {
    // 1. è§£ææ¶ˆæ¯ï¼Œè·å–session ID
    Json::Value request = parse_json(message);
    uint64_t ssid = request["session_id"].asUInt64();
    
    // 2. éªŒè¯sessionæœ‰æ•ˆæ€§
    session_ptr ssp = session_mgr->get_session_by_ssid(ssid);
    if (!ssp || !ssp->is_login()) {
        send_error(conn, "Sessionæ— æ•ˆï¼Œè¯·é‡æ–°ç™»å½•");
        return;
    }
    
    // 3. æ›´æ–°sessionæ´»è·ƒæ—¶é—´
    session_mgr->set_session_expire_time(ssid, 300000);  // é‡ç½®5åˆ†é’Ÿè¶…æ—¶
    
    // 4. å¤„ç†å…·ä½“ä¸šåŠ¡é€»è¾‘
    std::string cmd = request["cmd"].asString();
    if (cmd == "enter_hall") {
        handle_enter_hall(conn);
    } else if (cmd == "start_match") {
        handle_start_match(conn);
    }
    // ... æ›´å¤šå‘½ä»¤å¤„ç†
}
```

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡æ€æƒ³æ€»ç»“

### 1. **çŠ¶æ€ç®¡ç†æ¨¡å¼**
- Sessionä½œä¸ºç”¨æˆ·çŠ¶æ€çš„è½½ä½“
- é€šè¿‡çŠ¶æ€æœºæ¸…æ™°åœ°ç®¡ç†ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸ
- ä¸åŒçŠ¶æ€å¯¹åº”ä¸åŒçš„è¶…æ—¶ç­–ç•¥

### 2. **èµ„æºç®¡ç†æ¨¡å¼**  
- æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨ç®¡ç†å†…å­˜
- RAIIæ¨¡å¼ç¡®ä¿çº¿ç¨‹å®‰å…¨
- å®šæ—¶å™¨ç®¡ç†Sessionç”Ÿå‘½å‘¨æœŸ

### 3. **é«˜æ€§èƒ½è®¾è®¡**
- unordered_mapæä¾›O(1)æŸ¥æ‰¾
- WebSocketé¿å…é‡å¤è¿æ¥å¼€é”€
- å¼‚æ­¥å›è°ƒæœºåˆ¶æé«˜å¹¶å‘æ€§èƒ½

### 4. **å®¹é”™è®¾è®¡**
- è¶…æ—¶æœºåˆ¶é˜²æ­¢èµ„æºæ³„æ¼
- æ™ºèƒ½æŒ‡é’ˆé¿å…æ‚¬ç©ºæŒ‡é’ˆ
- çº¿ç¨‹å®‰å…¨ç¡®ä¿å¹¶å‘æ­£ç¡®æ€§

---

## ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ é¢„å‘Š

æŒæ¡äº†Sessionå’ŒWebSocketåï¼Œæ‚¨å·²ç»ç†è§£äº†ï¼š
- âœ… ç”¨æˆ·çŠ¶æ€ç®¡ç†
- âœ… å®æ—¶é€šä¿¡æœºåˆ¶  
- âœ… æ™ºèƒ½æŒ‡é’ˆåº”ç”¨
- âœ… å®šæ—¶å™¨ç¼–ç¨‹

---

## ğŸ” æ ¸å¿ƒä»£ç è¯¦ç»†è§£æ

### session_mgr æ˜¯ä»€ä¹ˆï¼Ÿ

#### ğŸ“ å˜é‡å®šä¹‰åˆ†æ

```cpp
// åœ¨ server.hpp ä¸­çš„å®šä¹‰ï¼š
class server {
private:
    user_table _ut;           // ç”¨æˆ·è¡¨ç®¡ç†å™¨
    online_manager _om;       // åœ¨çº¿ç”¨æˆ·ç®¡ç†å™¨  
    room_manager _rm;         // æˆ¿é—´ç®¡ç†å™¨
    matcher _mm;              // åŒ¹é…å™¨
    session_manager _sm;      // â†â†â† è¿™å°±æ˜¯ session_mgrï¼
    //               â†‘
    //        Sessionç®¡ç†å™¨å¯¹è±¡
};
```

#### ğŸ—ï¸ session_mgr å®Œæ•´å«ä¹‰è§£é‡Š

```cpp
session_manager _sm;
//      â†‘        â†‘
//   ç±»å‹å    å˜é‡å

// å«ä¹‰è§£é‡Šï¼š
// session_manager: ä¼šè¯ç®¡ç†å™¨ç±»
// _sm: Session Manager çš„ç¼©å†™ï¼Œè¡¨ç¤ºä¸€ä¸ªä¼šè¯ç®¡ç†å™¨å®ä¾‹
```

**ç”Ÿæ´»ç±»æ¯”ï¼šé…’åº—å‰å°ç³»ç»Ÿ**
```
é…’åº—ç®¡ç†ç³»ç»Ÿï¼š
â”œâ”€â”€ å®¢æˆ·ä¿¡æ¯ç®¡ç† (_ut)     â†’ èº«ä»½è¯ã€è”ç³»æ–¹å¼ç­‰
â”œâ”€â”€ åœ¨çº¿å®¢æˆ·ç®¡ç† (_om)     â†’ å½“å‰åœ¨é…’åº—çš„å®¢æˆ·
â”œâ”€â”€ æˆ¿é—´ç®¡ç† (_rm)         â†’ æˆ¿é—´åˆ†é…ã€æ¸…ç†ç­‰
â”œâ”€â”€ å®¢æˆ·åŒ¹é… (_mm)         â†’ æ‹¼æˆ¿ã€ç»„å›¢æœåŠ¡
â””â”€â”€ æˆ¿å¡ç®¡ç† (_sm)         â†’ æˆ¿å¡å‘æ”¾ã€è¿‡æœŸã€ç»­æœŸ
    â†‘
è¿™å°±æ˜¯ session_mgr çš„ä½œç”¨ï¼
```

### LOGIN æ˜¯ä»€ä¹ˆï¼Ÿ

#### ğŸ“Š ç™»å½•çŠ¶æ€æšä¸¾è¯¦è§£

```cpp
// åœ¨ session.hpp ä¸­å®šä¹‰ï¼š
typedef enum {
    UNLOGIN,    // å€¼ä¸º 0ï¼Œè¡¨ç¤ºæœªç™»å½•çŠ¶æ€
    LOGIN       // å€¼ä¸º 1ï¼Œè¡¨ç¤ºå·²ç™»å½•çŠ¶æ€  
} ss_statu;
//   â†‘
// Session Status çš„ç¼©å†™
```

#### ğŸ­ çŠ¶æ€å«ä¹‰å¯¹æ¯”

| çŠ¶æ€ | æ•°å€¼ | å«ä¹‰ | ç”Ÿæ´»ç±»æ¯” |
|------|------|------|----------|
| `UNLOGIN` | 0 | æœªç™»å½• | æ¸¸å®¢èº«ä»½ï¼Œåªèƒ½çœ‹ä¸èƒ½æ“ä½œ |
| `LOGIN` | 1 | å·²ç™»å½• | ä¼šå‘˜èº«ä»½ï¼Œå¯ä»¥ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½ |

#### ğŸ” LOGIN çš„ä½¿ç”¨åœºæ™¯

```cpp
// 1. åˆ›å»ºå·²ç™»å½•çš„Session
session_ptr ssp = _sm.create_session(uid, LOGIN);
//                                        â†‘
//                              è®¾ç½®ä¸ºå·²ç™»å½•çŠ¶æ€

// 2. æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•  
bool is_login() { 
    return (_statu == LOGIN);    // æ¯”è¾ƒå½“å‰çŠ¶æ€æ˜¯å¦ç­‰äºLOGIN
    //                â†‘
    //           LOGINå°±æ˜¯æ•°å€¼1
}
```

### å®Œæ•´ç™»å½•æµç¨‹ä»£ç è§£æ

#### ğŸš€ ç”¨æˆ·ç™»å½•çš„å®Œæ•´ä»£ç æµç¨‹

```cpp
// ä½ç½®ï¼šserver.hpp ç¬¬113è¡Œ
session_ptr ssp = _sm.create_session(uid, LOGIN);
//     â†‘        â†‘    â†‘                â†‘     â†‘
//  æ™ºèƒ½æŒ‡é’ˆ   å˜é‡å å¯¹è±¡   è°ƒç”¨æˆå‘˜å‡½æ•°  ç”¨æˆ·ID ç™»å½•çŠ¶æ€
```

#### ğŸ“ é€è¡Œè¯¦ç»†è§£é‡Š

```cpp
// ç¬¬112è¡Œï¼šä»æ•°æ®åº“éªŒè¯ç»“æœä¸­æå–ç”¨æˆ·ID
uint64_t uid = login_info["id"].asUInt64();
//   â†‘           â†‘            â†‘      â†‘
// 64ä½æ•´æ•°   JSONå¯¹è±¡   idå­—æ®µ   è½¬æ¢ä¸º64ä½æ•´æ•°

// è§£é‡Šï¼š
// login_info: ä»æ•°æ®åº“æŸ¥è¯¢è¿”å›çš„ç”¨æˆ·ä¿¡æ¯(JSONæ ¼å¼)
// ["id"]: è®¿é—®JSONä¸­çš„idå­—æ®µ
// asUInt64(): å°†JSONå€¼è½¬æ¢ä¸º64ä½æ— ç¬¦å·æ•´æ•°
// uid: ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ç¬¦

// ç¬¬113è¡Œï¼šåˆ›å»ºSession
session_ptr ssp = _sm.create_session(uid, LOGIN);
//     â†‘
// ç­‰ä»·äºï¼šstd::shared_ptr<session> ssp

// è¯¦ç»†åˆ†è§£ï¼š
// _sm: æœåŠ¡å™¨çš„sessionç®¡ç†å™¨å¯¹è±¡
// create_session(): session_managerç±»çš„æˆå‘˜å‡½æ•°
// uid: ä¼ å…¥ç”¨æˆ·IDï¼Œè¡¨ç¤ºè¿™ä¸ªSessionå±äºå“ªä¸ªç”¨æˆ·
// LOGIN: ä¼ å…¥ç™»å½•çŠ¶æ€ï¼Œè¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå·²ç™»å½•çš„Session
// ssp: è¿”å›çš„æ™ºèƒ½æŒ‡é’ˆï¼ŒæŒ‡å‘æ–°åˆ›å»ºçš„sessionå¯¹è±¡
```

#### ğŸ”§ create_session å‡½æ•°å†…éƒ¨å·¥ä½œåŸç†

```cpp
session_ptr create_session(uint64_t uid, ss_statu statu) {
    // ç¬¬1æ­¥ï¼šçº¿ç¨‹å®‰å…¨åŠ é”
    std::unique_lock<std::mutex> lock(_mutex);
    
    // ç¬¬2æ­¥ï¼šåˆ›å»ºæ–°çš„sessionå¯¹è±¡
    session_ptr ssp(new session(_next_ssid));
    //               â†‘              â†‘
    //           åˆ›å»ºsessionå¯¹è±¡   ä¼ å…¥SessionID
    
    // ç¬¬3æ­¥ï¼šè®¾ç½®sessionçš„å±æ€§
    ssp->set_statu(statu);    // è®¾ç½®ç™»å½•çŠ¶æ€ä¸ºLOGIN
    ssp->set_user(uid);       // è®¾ç½®ç”¨æˆ·ID
    
    // ç¬¬4æ­¥ï¼šå°†sessionå­˜å‚¨åˆ°ç®¡ç†å®¹å™¨ä¸­
    _session.insert(std::make_pair(_next_ssid, ssp));
    //                              â†‘          â†‘
    //                          SessionID   SessionæŒ‡é’ˆ
    
    // ç¬¬5æ­¥ï¼šå‡†å¤‡ä¸‹ä¸€ä¸ªSessionID
    _next_ssid++;
    
    // ç¬¬6æ­¥ï¼šè¿”å›åˆ›å»ºçš„session
    return ssp;
}  // ç¬¬7æ­¥ï¼šé”è‡ªåŠ¨é‡Šæ”¾
```

#### ğŸ¯ å†…å­˜å’Œå˜é‡çŠ¶æ€å˜åŒ–

```
åˆ›å»ºSessionçš„å†…å­˜å˜åŒ–è¿‡ç¨‹ï¼š

ç¬¬1æ­¥ï¼šè°ƒç”¨å‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _sessionå®¹å™¨     â”‚  ç©ºçš„æˆ–æœ‰å…¶ä»–session
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ _next_ssid = 1  â”‚  ä¸‹ä¸€ä¸ªå¯ç”¨ID
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬2æ­¥ï¼šåˆ›å»ºsessionå¯¹è±¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sspæ™ºèƒ½æŒ‡é’ˆ      â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚ sessionå¯¹è±¡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ _ssid = 1       â”‚
                            â”‚ _uid = 0(åˆå§‹)   â”‚  
                            â”‚ _statu=UNLOGIN  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬3æ­¥ï¼šè®¾ç½®å±æ€§å  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sspæ™ºèƒ½æŒ‡é’ˆ      â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚ sessionå¯¹è±¡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ _ssid = 1       â”‚
                            â”‚ _uid = 12345    â”‚ â† è®¾ç½®ç”¨æˆ·ID
                            â”‚ _statu = LOGIN  â”‚ â† è®¾ç½®ä¸ºå·²ç™»å½•
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬4æ­¥ï¼šæ’å…¥å®¹å™¨å
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _sessionå®¹å™¨     â”‚  
â”‚ [1] â†’ ssp       â”‚ â† æ–°å¢é”®å€¼å¯¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ _next_ssid = 2  â”‚ â† IDé€’å¢
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åç»­Sessionä½¿ç”¨ä»£ç 

#### ğŸ” Sessioné”™è¯¯æ£€æŸ¥

```cpp
// ç¬¬114-117è¡Œï¼šæ£€æŸ¥Sessionåˆ›å»ºæ˜¯å¦æˆåŠŸ
if (ssp.get() == nullptr) {
//  â†‘      â†‘         â†‘  
// æ™ºèƒ½æŒ‡é’ˆ è·å–åŸå§‹æŒ‡é’ˆ ç©ºæŒ‡é’ˆæ£€æŸ¥
    DLOG("åˆ›å»ºä¼šè¯å¤±è´¥");
    return http_resp(conn, false, websocketpp::http::status_code::internal_server_error, "åˆ›å»ºä¼šè¯å¤±è´¥");
}

// è§£é‡Šï¼š
// ssp.get(): ä»shared_pträ¸­è·å–åŸå§‹æŒ‡é’ˆ
// == nullptr: æ£€æŸ¥æŒ‡é’ˆæ˜¯å¦ä¸ºç©º
// å¦‚æœä¸ºç©ºï¼Œè¯´æ˜Sessionåˆ›å»ºå¤±è´¥ï¼Œè¿”å›é”™è¯¯å“åº”
```

#### â° è®¾ç½®Sessionè¶…æ—¶æ—¶é—´

```cpp  
// ç¬¬118è¡Œï¼šè®¾ç½®Sessionè¿‡æœŸæ—¶é—´
_sm.set_session_expire_time(ssp->ssid(), SESSION_TIMEOUT);
//  â†‘                        â†‘             â†‘
// sessionç®¡ç†å™¨        è·å–SessionID    è¶…æ—¶æ—¶é—´å¸¸é‡

// è¯¦ç»†è§£é‡Šï¼š
// ssp->ssid(): è°ƒç”¨sessionå¯¹è±¡çš„ssid()æ–¹æ³•ï¼Œè¿”å›SessionID
// SESSION_TIMEOUT: åœ¨session.hppä¸­å®šä¹‰çš„å¸¸é‡ï¼Œå€¼ä¸º30000(30ç§’)
// å«ä¹‰ï¼š30ç§’æ— æ´»åŠ¨åè‡ªåŠ¨åˆ é™¤Session
```

#### ğŸª è®¾ç½®Cookieè¿”å›SessionID

```cpp
// ç¬¬120-121è¡Œï¼šé€šè¿‡Cookieè¿”å›SessionIDç»™å®¢æˆ·ç«¯
std::string cookie_ssid = "SSID=" + std::to_string(ssp->ssid());
//     â†‘              â†‘      â†‘               â†‘
//  Cookieå­—ç¬¦ä¸²    Cookieå   å­—ç¬¦ä¸²æ‹¼æ¥    æ•°å­—è½¬å­—ç¬¦ä¸²

conn->append_header("Set-Cookie", cookie_ssid);
//              â†‘             â†‘
//         HTTPå“åº”å¤´       Cookieå†…å®¹

// è§£é‡Šï¼š
// std::to_string(): å°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²
// ä¾‹å¦‚ï¼šSessionIDä¸º123ï¼Œåˆ™cookie_ssid = "SSID=123"
// append_header(): åœ¨HTTPå“åº”ä¸­æ·»åŠ å¤´éƒ¨ä¿¡æ¯
// å®¢æˆ·ç«¯æ”¶åˆ°åä¼šè‡ªåŠ¨ä¿å­˜Cookieï¼Œåç»­è¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦
```

#### ğŸ‰ è¿”å›æˆåŠŸå“åº”

```cpp
// ç¬¬122è¡Œï¼šè¿”å›ç™»å½•æˆåŠŸå“åº”
return http_resp(conn, true, websocketpp::http::status_code::ok, "ç™»å½•æˆåŠŸ");
//         â†‘        â†‘     â†‘              â†‘                        â†‘
//      å“åº”å‡½æ•°   è¿æ¥  æˆåŠŸæ ‡å¿—      HTTPçŠ¶æ€ç 200              å“åº”æ¶ˆæ¯
```

### å®Œæ•´ç™»å½•æµç¨‹å›¾è§£

```
ç”¨æˆ·ç™»å½•å®Œæ•´æµç¨‹ï¼š

1. ç”¨æˆ·æäº¤ç”¨æˆ·åå¯†ç 
   â†“
2. éªŒè¯ç”¨æˆ·ä¿¡æ¯(æ•°æ®åº“æŸ¥è¯¢)
   â†“  
3. æå–ç”¨æˆ·IDï¼šuint64_t uid = login_info["id"].asUInt64()
   â†“
4. åˆ›å»ºSessionï¼šsession_ptr ssp = _sm.create_session(uid, LOGIN)
   â†“
5. æ£€æŸ¥åˆ›å»ºç»“æœï¼šif (ssp.get() == nullptr)
   â†“
6. è®¾ç½®è¶…æ—¶æ—¶é—´ï¼š_sm.set_session_expire_time(ssp->ssid(), SESSION_TIMEOUT)
   â†“
7. ç”ŸæˆCookieï¼šstd::string cookie_ssid = "SSID=" + std::to_string(ssp->ssid())
   â†“
8. è®¾ç½®å“åº”å¤´ï¼šconn->append_header("Set-Cookie", cookie_ssid)
   â†“
9. è¿”å›æˆåŠŸå“åº”ï¼šreturn http_resp(conn, true, ...)
   â†“
10. å®¢æˆ·ç«¯æ”¶åˆ°SessionIDï¼Œåç»­è¯·æ±‚æºå¸¦Cookie
```

### å˜é‡ç±»å‹å®Œæ•´å¯¹ç…§è¡¨

| å˜é‡å | å®Œæ•´ç±»å‹ | ç®€åŒ–ç†è§£ | ä½œç”¨ |
|--------|----------|----------|------|
| `_sm` | `session_manager` | Sessionç®¡ç†å™¨ | ç®¡ç†æ‰€æœ‰ç”¨æˆ·Session |
| `LOGIN` | `ss_statuæšä¸¾å€¼` | ç™»å½•çŠ¶æ€å¸¸é‡(å€¼ä¸º1) | è¡¨ç¤ºå·²ç™»å½•çŠ¶æ€ |
| `uid` | `uint64_t` | 64ä½ç”¨æˆ·ID | å”¯ä¸€æ ‡è¯†ç”¨æˆ·èº«ä»½ |
| `ssp` | `std::shared_ptr<session>` | Sessionæ™ºèƒ½æŒ‡é’ˆ | å®‰å…¨ç®¡ç†Sessionå¯¹è±¡ |
| `_next_ssid` | `uint64_t` | ä¸‹ä¸€ä¸ªSessionID | Sessionçš„å”¯ä¸€ç¼–å·ç”Ÿæˆå™¨ |
| `SESSION_TIMEOUT` | `#define 30000` | è¶…æ—¶æ—¶é—´å¸¸é‡ | 30ç§’æ— æ´»åŠ¨è‡ªåŠ¨æ¸…ç† |

### ğŸ” å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“

1. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨æšä¸¾è€Œä¸æ˜¯æ•°å­—ï¼Œé¿å…é”™è¯¯
2. **å†…å­˜å®‰å…¨**ï¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨ç®¡ç†å†…å­˜
3. **çº¿ç¨‹å®‰å…¨**ï¼šä½¿ç”¨mutexä¿æŠ¤å…±äº«æ•°æ®
4. **é”™è¯¯å¤„ç†**ï¼šæ£€æŸ¥nullptrï¼Œè¿”å›é”™è¯¯ç 
5. **çŠ¶æ€ç®¡ç†**ï¼šé€šè¿‡æšä¸¾æ¸…æ™°è¡¨è¾¾çŠ¶æ€
6. **ç½‘ç»œåè®®**ï¼šä½¿ç”¨Cookieç»´æŒä¼šè¯çŠ¶æ€

**ç¬¬3å°æ—¶å­¦ä¹ å®Œæˆï¼å‡†å¤‡æ¥å—æ£€æµ‹äº†å—ï¼Ÿ** ğŸ¯
